{% extends 'base.html' %}
{% block title %}Registration - Final Review{% endblock %}

{% block content %}
<div class="container py-4">
    <h1 class="text-center text-success mb-4">Registration Review</h1>
    
    <div class="card shadow-lg">
        <div class="card-body p-4">
            <h2 class="text-center mb-4">Please Review Your Information</h2>
            
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category if category != 'error' else 'danger' }} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <form method="post" action="{{ url_for('main.registration_page_7') }}" class="needs-validation" novalidate>
                <!-- Personal Information -->
                <div class="review-section mb-4">
                    <h3 class="border-bottom pb-2">Personal Information</h3>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <p><strong>Personnel Number:</strong> {{ data.personnel_number }}</p>
                            <p><strong>Rank:</strong> {{ data.rank }}</p>
                            <p><strong>Surname:</strong> {{ data.surname }}</p>
                            <p><strong>Other Names:</strong> {{ data.other_names }}</p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Date of Birth:</strong> {{ data.date_of_birth }}</p>
                            <p><strong>Gender:</strong> {{ data.gender }}</p>
                            <p><strong>Nationality:</strong> {{ data.nationality }}</p>
                            <p><strong>State of Origin:</strong> {{ data.state_of_origin }}</p>
                        </div>
                    </div>
                </div>

                <!-- Contact Information -->
                <div class="review-section mb-4">
                    <h3 class="border-bottom pb-2">Contact Information</h3>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <p><strong>Permanent Address:</strong> {{ data.permanent_address }}</p>
                            <p><strong>WhatsApp:</strong> {{ data.whatsapp }}</p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Facebook:</strong> {{ data.facebook }}</p>
                            <p><strong>Twitter:</strong> {{ data.twitter }}</p>
                        </div>
                    </div>
                </div>

                <!-- Next of Kin Information -->
                <div class="review-section mb-4">
                    <h3 class="border-bottom pb-2">Next of Kin Information</h3>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <p><strong>Name:</strong> {{ data.nok_name_1 }}</p>
                            <p><strong>Relationship:</strong> {{ data.nok_relationship_1 }}</p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Phone:</strong> {{ data.nok_phone_1 }}</p>
                            <p><strong>Address:</strong> {{ data.nok_address_1 }}</p>
                        </div>
                    </div>
                </div>

                <!-- Military Information -->
                <div class="review-section mb-4">
                    <h3 class="border-bottom pb-2">Military Information</h3>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <p><strong>Current Unit:</strong> {{ data.current_unit }}</p>
                            <p><strong>Date of Enlistment:</strong> {{ data.date_of_enlistment }}</p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Military Courses:</strong> {{ data.military_courses }}</p>
                        </div>
                    </div>
                </div>

                <!-- Medical Information -->
                <div class="review-section mb-4">
                    <h3 class="border-bottom pb-2">Medical Information</h3>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <p><strong>Blood Group:</strong> {{ data.blood_group }}</p>
                            <p><strong>Genotype:</strong> {{ data.genotype }}</p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Special Needs:</strong> {{ data.has_special_needs }}
                                {% if data.has_special_needs == 'yes' %}
                                    <br><em>Details: {{ data.special_needs_details }}</em>
                                {% endif %}
                            </p>
                            <p><strong>Medical Conditions:</strong> {{ data.has_medical_conditions }}
                                {% if data.has_medical_conditions == 'yes' %}
                                    <br><em>Details: {{ data.medical_conditions_details }}</em>
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Declaration -->
                <div class="mb-4">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="declaration" required>
                        <label class="form-check-label" for="declaration">
                            I declare that all the information provided above is true and correct to the best of my knowledge.
                        </label>
                        <div class="invalid-feedback">
                            You must agree before submitting.
                        </div>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="d-flex justify-content-between mt-4">
                    <button type="button" class="btn btn-secondary" 
                            onclick="window.location.href='{{ url_for('main.registration_page_6') }}'">
                        <i class="fas fa-arrow-left me-2"></i>Previous
                    </button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-check me-2"></i>Submit Registration
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

{% block scripts %}
<script>
// Form validation
(function () {
    'use strict'
    var forms = document.querySelectorAll('.needs-validation')
    Array.prototype.slice.call(forms).forEach(function (form) {
        form.addEventListener('submit', function (event) {
            if (!form.checkValidity()) {
                event.preventDefault()
                event.stopPropagation()
            }
            form.classList.add('was-validated')
        }, false)
    })
})()
</script>
{% endblock %}

{% endblock %}
