{% extends 'base.html' %}

{% block title %}Registration - Academic Records{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/registration/styles.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/registration/modern.css', v='1.1') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/registration/photo-preview.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/registration/progress-bar.css', v='1.0') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/registration/enhanced-form.css', v='1.0') }}">
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="registration-card">
                <!-- Header -->
                <div class="card-header bg-military text-white">
                    <h2 class="text-center mb-0">Academic Records</h2>
                </div>

                <!-- Progress Steps -->
                <div class="px-4 pt-4">
                    <div class="progress-steps" data-progress="4">
                        <div class="progress-step completed">
                            <div class="step-number">1</div>
                            <div class="step-label">Personal Info</div>
                        </div>
                        <div class="progress-step completed">
                            <div class="step-number">2</div>
                            <div class="step-label">Contact</div>
                        </div>
                        <div class="progress-step completed">
                            <div class="step-number">3</div>
                            <div class="step-label">Social Media</div>
                        </div>
                        <div class="progress-step completed">
                            <div class="step-number">4</div>
                            <div class="step-label">Next of Kin</div>
                        </div>
                        <div class="progress-step active">
                            <div class="step-number">5</div>
                            <div class="step-label">Education</div>
                        </div>
                        <div class="progress-step">
                            <div class="step-number">6</div>
                            <div class="step-label">Military Training</div>
                        </div>
                        <div class="progress-step">
                            <div class="step-number">7</div>
                            <div class="step-label">Review</div>
                        </div>
                    </div>
                </div>

                <!-- Flash Messages -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        <div class="px-4 pt-3">
                            {% for category, message in messages %}
                                <div class="alert alert-{{ category if category != 'error' else 'danger' }} alert-dismissible fade show" role="alert">
                                    {{ message }}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                {% endwith %}

                <form method="post" action="{{ url_for('main.registration_page_5') }}" class="needs-validation" novalidate>
                    <div class="card-body">
                        <!-- University/Polytechnic Section -->
                        <div class="card mb-4">
                            <div class="card-body">
                                <h4 class="card-title mb-3">University/Polytechnic/College of Education</h4>
                                <p class="text-muted mb-4">Enter your tertiary education details (at least one entry required)</p>

                                <div class="table-responsive mb-4">
                                    <table class="table table-bordered">
                                        <thead>
                                            <tr>
                                                <th>Serial</th>
                                                <th>Name of Institution <span class="text-danger">*</span></th>
                                                <th>Year From <span class="text-danger">*</span></th>
                                                <th>Year To <span class="text-danger">*</span></th>
                                                <th>Certificate Obtained <span class="text-danger">*</span></th>
                                                <th>Grade <span class="text-danger">*</span></th>
                                                <th>Remarks</th>
                                            </tr>
                                        </thead>
                                <tbody>
                                    {% for i in range(3) %}
                                    <tr>
                                        <td><input type="text" class="form-control" name="uni_serial[]" value="{{ session.get('uni_serial', [])[i] if session.get('uni_serial') and i < len(session.get('uni_serial')) else '' }}"></td>
                                        <td><input type="text" class="form-control" name="uni_name[]" required value="{{ session.get('uni_name', [])[i] if session.get('uni_name') and i < len(session.get('uni_name')) else '' }}"></td>
                                        <td><input type="number" class="form-control" name="uni_year_from[]" min="1950" max="2099" required value="{{ session.get('uni_year_from', [])[i] if session.get('uni_year_from') and i < len(session.get('uni_year_from')) else '' }}"></td>
                                        <td><input type="number" class="form-control" name="uni_year_to[]" min="1950" max="2099" required value="{{ session.get('uni_year_to', [])[i] if session.get('uni_year_to') and i < len(session.get('uni_year_to')) else '' }}"></td>
                                        <td><input type="text" class="form-control" name="uni_cert[]" required value="{{ session.get('uni_cert', [])[i] if session.get('uni_cert') and i < len(session.get('uni_cert')) else '' }}"></td>
                                        <td><input type="text" class="form-control" name="uni_grade[]" required value="{{ session.get('uni_grade', [])[i] if session.get('uni_grade') and i < len(session.get('uni_grade')) else '' }}"></td>
                                        <td><input type="text" class="form-control" name="uni_remarks[]" value="{{ session.get('uni_remarks', [])[i] if session.get('uni_remarks') and i < len(session.get('uni_remarks')) else '' }}"></td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>

                        <!-- Secondary Education Section -->
                        <div class="section-title mb-4">
                            <h4>Advanced Level/Senior Secondary School</h4>
                            <p class="text-muted">Enter your secondary education details</p>
                        </div>

                        <div class="table-responsive mb-4">
                            <table class="table table-bordered">
                                <thead class="table-light">
                                    <tr>
                                        <th>Serial</th>
                                        <th>Name of Institution</th>
                                        <th>Year From</th>
                                        <th>Year To</th>
                                        <th>Certificate Obtained</th>
                                        <th>Grade</th>
                                        <th>Remarks</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for i in range(2) %}
                                    <tr>
                                        <td><input type="text" class="form-control" name="sec_serial[]" value="{{ session.get('sec_serial', [])[i] if session.get('sec_serial') and i < len(session.get('sec_serial')) else '' }}"></td>
                                        <td><input type="text" class="form-control" name="sec_name[]" value="{{ session.get('sec_name', [])[i] if session.get('sec_name') and i < len(session.get('sec_name')) else '' }}"></td>
                                        <td><input type="number" class="form-control" name="sec_year_from[]" min="1950" max="2099" value="{{ session.get('sec_year_from', [])[i] if session.get('sec_year_from') and i < len(session.get('sec_year_from')) else '' }}"></td>
                                        <td><input type="number" class="form-control" name="sec_year_to[]" min="1950" max="2099" value="{{ session.get('sec_year_to', [])[i] if session.get('sec_year_to') and i < len(session.get('sec_year_to')) else '' }}"></td>
                                        <td><input type="text" class="form-control" name="sec_cert[]" value="{{ session.get('sec_cert', [])[i] if session.get('sec_cert') and i < len(session.get('sec_cert')) else '' }}"></td>
                                        <td><input type="text" class="form-control" name="sec_grade[]" value="{{ session.get('sec_grade', [])[i] if session.get('sec_grade') and i < len(session.get('sec_grade')) else '' }}"></td>
                                        <td><input type="text" class="form-control" name="sec_remarks[]" value="{{ session.get('sec_remarks', [])[i] if session.get('sec_remarks') and i < len(session.get('sec_remarks')) else '' }}"></td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>

                        <!-- Military Courses Section -->
                        <div class="section-title mb-4">
                            <h4>Previous Military Courses Attended</h4>
                            <p class="text-muted">Enter details of military courses you have attended</p>
                        </div>

                        <div class="table-responsive mb-4">
                            <table class="table table-bordered">
                                <thead class="table-light">
                                    <tr>
                                        <th>Serial</th>
                                        <th>Name of Institution</th>
                                        <th>Year From</th>
                                        <th>Year To</th>
                                        <th>Certificate Obtained</th>
                                        <th>Grade</th>
                                        <th>Remarks</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for i in range(3) %}
                                    <tr>
                                        <td><input type="text" class="form-control" name="mil_serial[]" value="{{ session.get('mil_serial', [])[i] if session.get('mil_serial') and i < len(session.get('mil_serial')) else '' }}"></td>
                                        <td><input type="text" class="form-control" name="mil_name[]" value="{{ session.get('mil_name', [])[i] if session.get('mil_name') and i < len(session.get('mil_name')) else '' }}"></td>
                                        <td><input type="number" class="form-control" name="mil_year_from[]" min="1950" max="2099" value="{{ session.get('mil_year_from', [])[i] if session.get('mil_year_from') and i < len(session.get('mil_year_from')) else '' }}"></td>
                                        <td><input type="number" class="form-control" name="mil_year_to[]" min="1950" max="2099" value="{{ session.get('mil_year_to', [])[i] if session.get('mil_year_to') and i < len(session.get('mil_year_to')) else '' }}"></td>
                                        <td><input type="text" class="form-control" name="mil_cert[]" value="{{ session.get('mil_cert', [])[i] if session.get('mil_cert') and i < len(session.get('mil_cert')) else '' }}"></td>
                                        <td><input type="text" class="form-control" name="mil_grade[]" value="{{ session.get('mil_grade', [])[i] if session.get('mil_grade') and i < len(session.get('mil_grade')) else '' }}"></td>
                                        <td><input type="text" class="form-control" name="mil_remarks[]" value="{{ session.get('mil_remarks', [])[i] if session.get('mil_remarks') and i < len(session.get('mil_remarks')) else '' }}"></td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>

                        <!-- NASS Information -->
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <label for="nass_course" class="form-label">Course of Attendance in NASS*</label>
                                <input type="text" class="form-control" id="nass_course" name="nass_course"
                                       value="{{ session.get('nass_course', '') }}" required>
                            </div>
                            <div class="col-md-6">
                                <label for="nass_department" class="form-label">Department in NASS*</label>
                                <input type="text" class="form-control" id="nass_department" name="nass_department"
                                       value="{{ session.get('nass_department', '') }}" required>
                            </div>
                        </div>

                        <!-- Navigation Buttons -->
                        <div class="form-navigation">
                            <button type="button" class="btn btn-outline-military"
                                    onclick="window.location.href='{{ url_for('main.registration_page_3') }}'">
                                <i class="fas fa-arrow-left me-2"></i> Previous
                            </button>
                            <button type="submit" class="btn btn-military">
                                Next Step <i class="fas fa-arrow-right ms-2"></i>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<!-- Include the modern registration JavaScript -->
<script src="{{ url_for('static', filename='js/registration/modern.js') }}"></script>

<script>
// Add animation classes to cards
document.addEventListener('DOMContentLoaded', function() {
    // Add animation classes to cards
    document.querySelectorAll('.card').forEach((card, index) => {
        card.style.animationDelay = `${index * 0.1}s`;
        card.classList.add('fade-in');
    });

    // Year validation with enhanced feedback
    const yearInputs = document.querySelectorAll('input[type="number"]');
    yearInputs.forEach(input => {
        input.addEventListener('input', function() {
            const yearFrom = this.closest('tr').querySelector('[name$="year_from[]"]');
            const yearTo = this.closest('tr').querySelector('[name$="year_to[]"]');

            if (yearFrom && yearTo && yearFrom.value && yearTo.value) {
                if (parseInt(yearFrom.value) > parseInt(yearTo.value)) {
                    yearTo.setCustomValidity('Year To must be greater than Year From');
                    yearTo.classList.add('is-invalid');

                    // Create or update error message
                    let errorMsg = yearTo.nextElementSibling;
                    if (!errorMsg || !errorMsg.classList.contains('invalid-feedback')) {
                        errorMsg = document.createElement('div');
                        errorMsg.className = 'invalid-feedback';
                        yearTo.parentNode.appendChild(errorMsg);
                    }
                    errorMsg.textContent = 'Year To must be greater than Year From';
                } else {
                    yearTo.setCustomValidity('');
                    yearTo.classList.remove('is-invalid');
                    yearTo.classList.add('is-valid');
                }
            }
        });
    });

    // Add table row hover effects
    document.querySelectorAll('tbody tr').forEach(row => {
        row.addEventListener('mouseenter', () => {
            row.style.backgroundColor = 'var(--military-dark-blue-50)';
            row.style.transition = 'background-color 0.3s ease';
        });

        row.addEventListener('mouseleave', () => {
            row.style.backgroundColor = '';
        });
    });
});
</script>
{% endblock %}

